---
// Theme toggle component for switching between light and dark modes
---

<button 
  id="theme-toggle" 
  class="focus-ring relative inline-flex items-center justify-center w-10 h-10 rounded-lg border transition-all duration-200 theme-toggle-btn"
  aria-label="Toggle theme"
  title="Toggle theme"
>
  <!-- Sun icon for light mode -->
  <svg 
    id="sun-icon" 
    class="w-5 h-5 transition-all duration-300 sun-icon"
    fill="none" 
    stroke="currentColor" 
    viewBox="0 0 24 24"
  >
    <path 
      stroke-linecap="round" 
      stroke-linejoin="round" 
      stroke-width="2" 
      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
    />
  </svg>
  
  <!-- Moon icon for dark mode -->
  <svg 
    id="moon-icon" 
    class="absolute w-5 h-5 transition-all duration-300 moon-icon"
    fill="none" 
    stroke="currentColor" 
    viewBox="0 0 24 24"
  >
    <path 
      stroke-linecap="round" 
      stroke-linejoin="round" 
      stroke-width="2" 
      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
    />
  </svg>
</button>

<script>
  function initThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');
    
    // Get the stored theme or default to 'light'
    const getStoredTheme = () => localStorage.getItem('theme') || 'light';
    
    // Set the theme
    const setTheme = (theme: string) => {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      
      // Also manage the 'dark' class for Tailwind compatibility
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    };
    
    // Initialize theme on page load
    let initialTheme = getStoredTheme();
    
    // Only check system preference if no theme is stored
    if (!localStorage.getItem('theme')) {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      initialTheme = prefersDark ? 'dark' : 'light';
    }
    
    setTheme(initialTheme);
    
    // Theme toggle handler
    themeToggle?.addEventListener('click', () => {
      const currentTheme = getStoredTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
      
      // Add a little bounce animation
      themeToggle.style.transform = 'scale(0.95)';
      setTimeout(() => {
        themeToggle.style.transform = 'scale(1)';
      }, 100);
    });
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        setTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
  
  // Initialize on DOM content loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }
  
  // Re-initialize on navigation (for SPA-like behavior)
  document.addEventListener('astro:page-load', initThemeToggle);
</script>

<style>
  .theme-toggle-btn {
    background: var(--color-card);
    border-color: var(--color-border);
    box-shadow: var(--shadow-sm);
  }
  
  .theme-toggle-btn:hover {
    background: var(--color-card-hover);
    border-color: var(--color-border-hover);
    box-shadow: var(--shadow);
  }
  
  /* Sun icon styling */
  .sun-icon {
    color: #f59e0b; /* yellow-500 */
    opacity: 1;
    transform: rotate(0deg);
  }
  
  /* Moon icon styling */
  .moon-icon {
    color: #60a5fa; /* blue-400 */
    opacity: 0;
    transform: rotate(90deg);
  }
  
  /* Dark theme overrides */
  [data-theme="dark"] .sun-icon {
    opacity: 0;
    transform: rotate(90deg);
  }
  
  [data-theme="dark"] .moon-icon {
    opacity: 1;
    transform: rotate(0deg);
  }
</style>